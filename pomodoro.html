<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄钟 - 梦是榛果巧克力</title>
    <style>
        body {
            font-family: "Microsoft Yahei", sans-serif;
            background-image: url('background.3.jpg');
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            margin: 20px auto;
        }

        /* 番茄钟样式 */
        .pomodoro {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .progress-circle {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(#D9B1BD 0% 50%, #e0e0e0 50% 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .progress-circle span {
            position: absolute;
            font-size: 2em;
            font-weight: bold;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #D9B1BD;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #a03a53;
        }
        .log {
            margin-top: 20px;
        }
        .log textarea {
            width: 100%;
            height: 60px;
            margin-top: 10px;
            border-radius: 5px;
            background: rgba(230, 230, 230, 1);
            padding: 10px;
            border: none;
            font-size: 1em;
        }

        /* 学习积分和成就墙样式 */
        .section {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        .section h3 {
            text-align: center;
            margin-bottom: 20px;
        }
        .button {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .button button {
            padding: 10px 20px;
        }

        /* 动态特效 */
        .sparkle {
            position: fixed;
            top: -50px;
            width: 20px;
            height: 20px;
            background: rgba(255, 223, 0, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 223, 0, 0.8);
            animation: fall 2s ease-in-out forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(800px) translateX(200px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 番茄钟 -->
        <div class="pomodoro">
            <h2>番茄钟</h2>
            <div class="progress-circle" id="progress">
                <span id="timer">25:00</span>
            </div>
            <div class="controls">
                <input type="number" id="customTime" placeholder="分钟数" min="1" max="60">
                <button onclick="setCustomTime()">设置时间</button>
                <button onclick="startTimer()">开始</button>
                <button onclick="pauseTimer()">暂停</button>
                <button onclick="resetTimer()">重置</button>
            </div>
            <div class="log">
                <textarea id="logInput" placeholder="完成学习后写下学了什么..."></textarea>
                <button onclick="saveLog()">保存记录</button>
            </div>
        </div>
        <!-- 学习积分 -->
        <div class="section">
            <h3>学习积分</h3>
            <p>数据截至：<span id="currentTime"></span></p>
            <p>当前已累计得分：<span id="points">0</span> 分</p>
            <div class="button">
                <button id="redeemButton" onclick="redeem()">兑换情书</button>
            </div>
        </div>

        <!-- 成就墙 -->
        <div class="section">
            <h3>泉泉的成就墙</h3>
            <p>已累计学习：<span id="totalTime">0</span> 分钟</p>
            <p>已累计完成番茄钟次数：<span id="totalPomodoros">0</span> 次</p>
            <p>已完成学习目标：<span id="totalGoals">0</span> 个</p>
            <p>已收获情书：<span id="letters">0</span> 封</p>
        </div>
    </div>

    <script>
        let interval;
        let time = 25 * 60;
        let points = 0;
        let totalPomodoros = 0;
        let letters = 0;

        function updateTimerDisplay() {
            const minutes = Math.floor(time / 60).toString().padStart(2, '0');
            const seconds = (time % 60).toString().padStart(2, '0');
            document.getElementById("timer").innerText = `${minutes}:${seconds}`;
            const percentage = ((25 * 60 - time) / (25 * 60)) * 100;
            document.getElementById("progress").style.background = `conic-gradient(#D9B1BD 0% ${percentage}%, #e0e0e0 ${percentage}% 100%)`;
        }

        function startTimer() {
            clearInterval(interval);
            interval = setInterval(() => {
                if (time > 0) {
                    time--;
                    updateTimerDisplay();
                } else {
                    clearInterval(interval);
                    alert("时间到！请记录学习内容。");
                    addSparkle();
                    points++;
                    totalPomodoros++;
                    updateStats();
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(interval);
        }

        function resetTimer() {
            clearInterval(interval);
            time = 25 * 60;
            updateTimerDisplay();
        }

        function setCustomTime() {
            const customTime = parseInt(document.getElementById("customTime").value);
            if (customTime && customTime > 0) {
                time = customTime * 60;
                updateTimerDisplay();
            } else {
                alert("请输入有效的分钟数！");
            }
        }

        function redeem() {
            if (points >= 30) {
                letters++;
                points -= 30;
                const loveLetters = [
                    "亲爱的泉泉：\n这是阿湛送妳的第一封情书，希望妳每天都能感受到我的爱～",
                    "泉泉：\n每完成一次番茄钟，妳就在梦想的路上更进一步，我永远陪着妳！",
                    // 更多情书内容……
                ];
                const letterContent = loveLetters[letters - 1] || "未来的情书等着妳解锁哦～";
                const blob = new Blob([letterContent], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `阿湛写给泉泉的情书_${letters}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert("兑换成功！情书已为妳准备好啦！");
                updateStats();
            } else {
                alert("积分不足！完成更多番茄钟吧！");
            }
        }

        function updateStats() {
            document.getElementById("points").innerText = points;
            document.getElementById("totalPomodoros").innerText = totalPomodoros;
            document.getElementById("letters").innerText = letters;
            document.getElementById("currentTime").innerText = new Date().toLocaleString();
        }

        function addSparkle() {
            const sparkle = document.createElement("div");
            sparkle.className = "sparkle";
            sparkle.style.left = `${Math.random() * window.innerWidth}px`;
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 2000);
        }

        window.onload = updateStats;
    </script>
</body>
</html>
